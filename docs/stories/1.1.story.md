# Story 1.1: Project Bootstrap and Canary

## Status
✅ Done (2025-10-29) - QA Approved

## Story
**As a** developer,
**I want** a minimal client app shell and build tooling,
**so that** I can render a canary page and iterate quickly.

## Acceptance Criteria
1. App builds and serves a simple canvas with placeholder UI panels.
2. Project includes linter/formatter and basic CI checks (build only).
3. Canary page renders an empty SVG scene without errors.

## Tasks / Subtasks

- [ ] Task 1: Initialize monorepo structure with npm workspaces (AC: 1, 2)
  - [ ] Create package.json at root with workspaces config for apps/* and packages/*
  - [ ] Create apps/web/package.json with Vite, TypeScript, and dev dependencies
  - [ ] Create packages/shared/package.json for shared types
  - [ ] Create packages/engine/package.json for core engine (placeholder for now)
  - [ ] Create tsconfig.base.json at root for shared TypeScript configuration
  - [ ] Create tsconfig.json files for each workspace extending base config

- [ ] Task 2: Configure Vite build tooling for apps/web (AC: 1, 2)
  - [ ] Create vite.config.ts with TypeScript support
  - [ ] Create apps/web/index.html as entry point
  - [ ] Create apps/web/src/main.ts as application entry
  - [ ] Add build, dev, and typecheck scripts to apps/web/package.json

- [ ] Task 3: Set up linter and formatter (AC: 2)
  - [ ] Install and configure ESLint with TypeScript plugin
  - [ ] Configure Prettier for consistent formatting
  - [ ] Add lint and format scripts to root package.json
  - [ ] Create .eslintrc.json and .prettierrc configuration files

- [ ] Task 4: Implement minimal HTML shell with canvas and placeholder panels (AC: 1, 3)
  - [ ] Create apps/web/index.html with root div and basic structure
  - [ ] Create apps/web/src/main.ts to initialize app
  - [ ] Add container divs for canvas area and control panels
  - [ ] Add minimal CSS for layout (flexbox or grid for canvas + panels)

- [ ] Task 5: Render empty SVG scene in canvas area (AC: 3)
  - [ ] Create apps/web/src/components/canvas/Canvas.ts component
  - [ ] Initialize empty SVG element with basic viewBox and namespace
  - [ ] Append SVG to canvas container in DOM
  - [ ] Verify SVG renders without console errors

- [ ] Task 6: Add placeholder UI panel using Tweakpane (AC: 1)
  - [ ] Install Tweakpane dependency in apps/web
  - [ ] Create apps/web/src/components/panels/PlaceholderPanel.ts
  - [ ] Initialize Tweakpane instance with placeholder controls
  - [ ] Mount panel to designated panel container
  - [ ] Verify panel renders and is interactive

- [ ] Task 7: Configure GitHub Actions CI pipeline (AC: 2)
  - [ ] Create .github/workflows/ci.yml workflow file
  - [ ] Configure job to install dependencies with npm ci
  - [ ] Add typecheck step running across all workspaces
  - [ ] Add lint step running across all workspaces
  - [ ] Add build step for apps/web to verify build succeeds
  - [ ] Configure workflow to run on push and pull_request events

- [ ] Task 8: Write unit tests for Canvas component (AC: 3)
  - [ ] Install Vitest and Testing Library in apps/web
  - [ ] Create apps/web/tests/Canvas.test.ts
  - [ ] Write test verifying SVG element is created with correct namespace
  - [ ] Write test verifying SVG has viewBox attribute
  - [ ] Add test script to apps/web/package.json
  - [ ] Verify tests pass with npm test

- [ ] Task 9: Create basic project documentation (AC: 2)
  - [ ] Create README.md at root with project overview
  - [ ] Document setup instructions (npm install, npm run dev)
  - [ ] Document available scripts (build, dev, test, lint, typecheck)
  - [ ] Add project structure overview

- [ ] Task 10: Manual verification and smoke test (AC: 1, 2, 3)
  - [ ] Run npm install to verify workspace setup
  - [ ] Run npm run dev and verify dev server starts without errors
  - [ ] Open browser and verify empty SVG canvas renders
  - [ ] Verify placeholder panel displays
  - [ ] Run npm run typecheck and verify no type errors
  - [ ] Run npm run lint and verify linting passes
  - [ ] Run npm test and verify all tests pass
  - [ ] Run npm run build and verify production build succeeds

## Dev Notes

### Previous Story Insights
N/A - This is the first story.

### Tech Stack
[Source: architecture/tech-stack.md]
- **Frontend Language:** TypeScript 5.6.x
- **Frontend Framework:** None (Vanilla TS + Vite) - PRD specifies no framework needed
- **UI Component Library:** Tweakpane 4.x for parameter panels
- **Build Tool:** Vite 5.x with esbuild (dev) + Rollup (prod)
- **Frontend Testing:** Vitest + Testing Library (latest)
- **E2E Testing:** Playwright (defer to later stories)
- **Bundler:** esbuild (dev) + Rollup (prod) via Vite defaults
- **CI/CD:** GitHub Actions for build + preview + deploy
- **CSS Framework:** Tailwind CSS 3.x (optional, can use for layout)

### Project Structure
[Source: architecture/unified-project-structure.md]

Create the following directory structure:
```
v-tool/
  .github/
    workflows/
      ci.yml
  apps/
    web/
      src/
        components/
          canvas/
            Canvas.ts
          panels/
            PlaceholderPanel.ts
        main.ts
      index.html
      vite.config.ts
      tsconfig.json
      package.json
    api/                   # future, not needed for Story 1.1
  packages/
    shared/
      src/
        types.ts           # placeholder for shared types
      package.json
      tsconfig.json
    engine/
      src/                 # placeholder for future engine code
      package.json
      tsconfig.json
  package.json             # workspace root
  tsconfig.base.json
  README.md
  .eslintrc.json
  .prettierrc
```

**Key Notes:**
- Start with apps/web and packages/shared only
- Keep shared types in packages/shared to prevent drift
- packages/engine can be placeholder for now; will expand in later stories

### Component Architecture
[Source: architecture/frontend-architecture.md#component-architecture]

**Component Template Pattern:**
```typescript
// Component functions return a cleanup function
export function ComponentName(root: HTMLElement) {
  // Initialize component logic
  // Attach to DOM
  // Return cleanup function
  return () => {
    // Cleanup logic
  };
}
```

**Canvas Component Requirements:**
- Create SVG element with proper namespace: `http://www.w3.org/2000/svg`
- Set basic viewBox (can be placeholder like `0 0 800 600`)
- Append to provided root element
- Return cleanup function for future use

**Panel Component Requirements:**
- Use Tweakpane for UI controls
- Import Pane from 'tweakpane'
- Pass container to Pane constructor
- Return cleanup function that calls `pane.dispose()`

### State Management
[Source: architecture/frontend-architecture.md#state-management-architecture]

**For Story 1.1 (Canary):**
State management is NOT required yet. Story 1.1 only needs to render empty SVG and placeholder panel.

**Future Reference (for later stories):**
```typescript
// apps/web/src/store/store.ts pattern (NOT needed for 1.1)
let scene: Scene;
const listeners = new Set<(s: Scene) => void>();
export function init(initial: Scene) { scene = initial; }
export function getState(): Scene { return scene; }
export function update(patch: Partial<Scene>) {
  scene = { ...scene, ...patch };
  listeners.forEach((l) => l(scene));
}
```

### Coding Standards
[Source: architecture/coding-standards.md]

**Naming Conventions:**
- Components: PascalCase — `Canvas.ts`, `PlaceholderPanel.ts`
- Hooks/Helpers: camelCase — `formatError.ts`
- Local Storage Keys: dot.notation — `vtool.presets` (not needed for 1.1)

**Critical Rules:**
- Type Sharing: Define all domain types in packages/shared
- Never mutate state in place (when state is added in later stories)
- Access environment via config module, not direct process.env

### CI/CD Configuration
[Source: architecture/cicd.md]

**GitHub Actions Workflow (.github/workflows/ci.yml):**
```yaml
name: CI
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - run: npm ci
      - run: npm run typecheck --workspaces
      - run: npm run lint --workspaces || true
      - run: npm test --workspaces --if-present
      - run: npm run -w apps/web build
```

**Pipeline Requirements:**
- Run on push and pull_request events
- Use Node.js 20
- Install dependencies with npm ci (not npm install)
- Run typecheck across all workspaces
- Run lint across all workspaces (|| true allows CI to pass even with lint warnings)
- Run tests if present (--if-present flag)
- Build apps/web to verify production build succeeds

### Vite Configuration
[Source: architecture/tech-stack.md, architecture/frontend-architecture.md]

**vite.config.ts requirements:**
```typescript
import { defineConfig } from 'vite';

export default defineConfig({
  // Basic config for TypeScript support
  // Vite has TS support by default, minimal config needed
});
```

**package.json scripts for apps/web:**
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "typecheck": "tsc --noEmit"
  }
}
```

### Dependencies to Install

**Root package.json devDependencies:**
- typescript@^5.6.0
- @typescript-eslint/parser@^7.0.0
- @typescript-eslint/eslint-plugin@^7.0.0
- eslint@^8.0.0
- prettier@^3.0.0

**apps/web dependencies:**
- tweakpane@^4.0.0

**apps/web devDependencies:**
- vite@^5.0.0
- vitest@latest
- @testing-library/dom@latest
- typescript@^5.6.0

**packages/shared devDependencies:**
- typescript@^5.6.0

**packages/engine devDependencies:**
- typescript@^5.6.0

### HTML Structure
[Source: architecture/frontend-architecture.md, architecture/high-level-architecture.md]

**index.html basic structure:**
```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>V-Tool</title>
  </head>
  <body>
    <div id="app">
      <div id="canvas-container"></div>
      <div id="panels-container"></div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
```

**main.ts entry point:**
```typescript
import { Canvas } from './components/canvas/Canvas';
import { PlaceholderPanel } from './components/panels/PlaceholderPanel';

const canvasRoot = document.getElementById('canvas-container');
const panelsRoot = document.getElementById('panels-container');

if (canvasRoot) Canvas(canvasRoot);
if (panelsRoot) PlaceholderPanel(panelsRoot);
```

### Testing

[Source: architecture/testing-strategy.md]

**Test Organization:**
```
apps/web/
  tests/            # component tests (Vitest + Testing Library)
  e2e/              # Playwright tests (defer to later stories)
```

**Component Test Pattern:**
```typescript
import { describe, it, expect } from 'vitest';

describe('Canvas', () => {
  it('creates SVG element with correct namespace', () => {
    const root = document.createElement('div');
    Canvas(root);
    const svg = root.querySelector('svg');
    expect(svg).toBeTruthy();
    expect(svg?.namespaceURI).toBe('http://www.w3.org/2000/svg');
  });

  it('sets viewBox attribute', () => {
    const root = document.createElement('div');
    Canvas(root);
    const svg = root.querySelector('svg');
    expect(svg?.getAttribute('viewBox')).toBeTruthy();
  });
});
```

**Test Configuration:**
- Use Vitest for unit/component tests
- Tests located in apps/web/tests/
- E2E tests with Playwright deferred to later stories
- Test command: `npm test` in apps/web

### Technical Constraints
[Source: architecture/tech-stack.md, architecture/high-level-architecture.md]

- **No Backend:** Client-only MVP, no API services
- **No Database:** All state in-memory for now, localStorage later
- **No Authentication:** Not needed for MVP
- **Platform:** Static SPA, will deploy to Vercel in future stories
- **Browser Support:** Modern browsers with SVG support
- **Minimal Framework:** Vanilla TypeScript + Vite, no React/Vue/Svelte

### Performance Considerations
[Source: architecture/high-level-architecture.md]

**For Story 1.1:** Performance not critical yet (empty scene).

**Future Reference:**
- Target ~1-2k instances without frame drops on mid-tier hardware
- Use SVG <defs>/<symbol>/<use> pattern to minimize DOM size
- Implement debouncing for rapid parameter changes (later stories)

### File Locations Summary

**Files to Create:**
1. Root level:
   - package.json (workspaces root)
   - tsconfig.base.json
   - README.md
   - .eslintrc.json
   - .prettierrc
   - .gitignore

2. .github/workflows/ci.yml

3. apps/web/:
   - package.json
   - tsconfig.json
   - vite.config.ts
   - index.html
   - src/main.ts
   - src/components/canvas/Canvas.ts
   - src/components/panels/PlaceholderPanel.ts

4. apps/web/tests/:
   - Canvas.test.ts

5. packages/shared/:
   - package.json
   - tsconfig.json
   - src/types.ts (placeholder)

6. packages/engine/:
   - package.json
   - tsconfig.json
   - src/index.ts (placeholder)

### Acceptance Criteria Implementation Notes

**AC 1: App builds and serves a simple canvas with placeholder UI panels**
- Implemented by Tasks 1-6: Set up project structure, Vite, canvas, and panel components
- Verified by Task 10: Manual smoke test confirms dev server runs and UI renders

**AC 2: Project includes linter/formatter and basic CI checks (build only)**
- Implemented by Task 3: ESLint + Prettier configuration
- Implemented by Task 7: GitHub Actions workflow with typecheck, lint, build
- Verified by Task 10: Running lint and CI commands succeeds

**AC 3: Canary page renders an empty SVG scene without errors**
- Implemented by Task 5: Canvas component creates and renders SVG element
- Implemented by Task 8: Unit tests verify SVG creation
- Verified by Task 10: Browser smoke test confirms no console errors

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-29 | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

This section was populated by the development agent during implementation.

### Agent Model Used

Claude Sonnet 4.5 (via Cursor)

### Debug Log References

N/A - No critical debugging required. Minor issues resolved:
- Fixed TypeScript tsconfig.json rootDir issue for test files
- Resolved Tweakpane 4.x API type issues with temporary `as any` workaround

### Completion Notes List

**Implementation Date:** 2025-10-29

**All Acceptance Criteria Met:**

1. ✅ **AC1:** App builds and serves a simple canvas with placeholder UI panels
   - Dev server runs on port 3330
   - Canvas displays empty SVG (800x600 viewBox)
   - Tweakpane panel renders with placeholder controls

2. ✅ **AC2:** Project includes linter/formatter and basic CI checks
   - ESLint configured with TypeScript support
   - Prettier configured for code formatting
   - GitHub Actions CI pipeline configured (build, typecheck, lint, test)

3. ✅ **AC3:** Canary page renders an empty SVG scene without errors
   - SVG element created with correct namespace
   - No console errors on page load
   - Unit tests verify SVG rendering

**Verification Results:**
- ✅ Type checking: All workspaces pass
- ✅ Linting: All files pass ESLint
- ✅ Unit tests: 4/4 tests passing (Canvas component)
- ✅ Production build: Successful (153KB bundled)
- ✅ Dev server: Running on http://localhost:3330

### File List

**Created Files:**

Root Configuration:
- package.json (workspace root)
- tsconfig.base.json
- .eslintrc.json
- .prettierrc
- .gitignore
- README.md

CI/CD:
- .github/workflows/ci.yml

Web Application (apps/web):
- package.json
- tsconfig.json
- vite.config.ts
- vitest.config.ts
- index.html
- src/main.ts
- src/components/canvas/Canvas.ts
- src/components/panels/PlaceholderPanel.ts
- tests/Canvas.test.ts

Shared Package (packages/shared):
- package.json
- tsconfig.json
- src/types.ts

Engine Package (packages/engine):
- package.json
- tsconfig.json
- src/index.ts

**Total Files Created:** 23

## QA Results

### Review Date: 2025-10-29
### Reviewed By: Quinn (Senior Developer & QA Architect)

### Code Quality Assessment

**Overall Quality: Excellent** ✅

Implementation demonstrates solid software engineering practices with clean, maintainable code. Project structure follows architectural guidance precisely. All acceptance criteria are met with comprehensive test coverage for core functionality. TypeScript configuration is strict and appropriate for production code.

The canary build successfully establishes a foundation for future development with proper separation of concerns, workspace-based monorepo structure, and automated CI/CD pipeline.

### Refactoring Performed

Three improvements made during review:

**File: apps/web/src/main.ts**
- **Change**: Replaced hard error throw with user-friendly error handling
- **Why**: Throwing uncaught errors in main entry point creates poor UX and unhelpful error messages for end users
- **How**: Replaced `throw new Error()` with `console.error()` + graceful fallback UI message. Wrapped component initialization in else block for clean control flow.

**File: apps/web/src/components/canvas/Canvas.ts**
- **Change 1**: Added accessibility attributes (`role="img"` and `aria-label`)
- **Why**: SVG canvas needs to be accessible to screen readers and assistive technologies
- **How**: Added semantic ARIA attributes describing the canvas purpose

- **Change 2**: Made cleanup function defensive
- **Why**: Cleanup could fail if SVG element was already removed from DOM by external code
- **How**: Added `if (svg.parentNode === root)` check before removeChild call

### Compliance Check

- **Coding Standards**: ✅ 
  - PascalCase for components: ✓
  - Functional component pattern with cleanup: ✓
  - Type safety (strict mode): ✓
  - Clean, self-documenting code: ✓

- **Project Structure**: ✅ 
  - Workspace configuration correct: ✓
  - File locations match Dev Notes guidance: ✓
  - Shared types in packages/shared: ✓
  - Proper separation between apps/web and packages: ✓

- **Testing Strategy**: ✅ 
  - Vitest properly configured with jsdom: ✓
  - Canvas component has comprehensive unit tests (4 tests): ✓
  - Tests verify namespace, attributes, DOM integration, cleanup: ✓
  - All tests passing: ✓

- **All ACs Met**: ✅ 
  - AC1 (builds, canvas, panels): ✓
  - AC2 (linter, formatter, CI): ✓
  - AC3 (empty SVG, no errors): ✓

### Test Coverage Analysis

**Canvas.ts**: Excellent coverage (4/4 tests)
- ✓ SVG creation with correct namespace
- ✓ ViewBox attribute validation
- ✓ DOM integration
- ✓ Cleanup function behavior

**PlaceholderPanel.ts**: No unit tests
- **Rationale**: Tweakpane UI library doesn't work in jsdom test environment
- **Impact**: Low risk - placeholder component for canary, visual verification sufficient
- **Future**: Consider Playwright E2E tests when implementing real panels (Story 2.x+)

### Architecture Review

**Strengths:**
1. Clean functional component pattern with proper cleanup lifecycle
2. Proper TypeScript strict mode configuration
3. Workspace monorepo structure scales well for future packages
4. CI pipeline includes all necessary checks (typecheck, lint, test, build)
5. SVG namespace handling is correct
6. Component separation (Canvas vs Panel) is logical

**Technical Debt (Low Priority):**
1. `as any` type workaround in PlaceholderPanel.ts for Tweakpane v4 types
   - Documented with inline comment
   - Acceptable for canary phase
   - Should be resolved when Tweakpane types stabilize

2. Inline styles in index.html
   - Currently appropriate for canary
   - Future: Extract to CSS file or Tailwind classes (mentioned in tech stack)

### Security Review

**Status**: ✅ No security concerns

- No user input handling yet (static canary)
- No external API calls
- No authentication/authorization needed
- DOM manipulation uses safe browser APIs
- TypeScript strict mode prevents common type-related vulnerabilities

### Performance Considerations

**Status**: ✅ Performance appropriate for scope

**Current Implementation:**
- Empty SVG with minimal overhead
- Single Tweakpane instance (lightweight)
- No render loops or animation yet
- Bundle size: 153KB (reasonable for dev build)

**Future Optimization Notes:**
- SVG `<defs>`/`<use>` pattern mentioned in Dev Notes will be critical for 1-2k instances (Story 2.x+)
- Consider virtualizing controls if panel grows beyond ~50 parameters

### Improvements Summary

**Completed by QA:**
- [x] Improved error handling in main.ts (user-friendly fallback)
- [x] Added accessibility attributes to Canvas SVG
- [x] Made Canvas cleanup function defensive
- [x] Verified all tests pass after refactoring
- [x] Confirmed typecheck passes for all workspaces
- [x] Validated lint rules are properly enforced

**Future Considerations (Non-Blocking):**
- [ ] Add Playwright E2E test for visual regression (defer to Story 2.x)
- [ ] Extract inline styles to CSS file when design system matures
- [ ] Resolve Tweakpane type workaround when types stabilize
- [ ] Add error boundary pattern when app complexity increases

### CI/CD Validation

**GitHub Actions Workflow**: ✅ Properly configured
- Node.js 20: ✓
- Install with `npm ci`: ✓
- Typecheck all workspaces: ✓
- Lint with graceful failure: ✓
- Test with `--if-present`: ✓
- Build apps/web: ✓

**Branch Strategy**: Runs on `main` and `Foundation` branches + PRs

### Developer Experience

**Setup**: ✅ Smooth
- README.md provides clear instructions
- Workspace dependencies resolve correctly
- Dev server runs on port 3330
- Hot reload works properly

### Final Status

**✅ APPROVED - Story Ready for Done**

All acceptance criteria met. Code quality is production-ready for canary phase. Refactoring improvements applied. No blocking issues identified. Story 1.1 successfully establishes a solid foundation for Epic 1 development.

**Recommendation**: Proceed to Story 1.2 (SVG Distribution System)

